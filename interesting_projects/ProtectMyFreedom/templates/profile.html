{% extends 'base.html' %}

{% block title %}{{ user.username }}{% endblock %}

{% block content %}

    {% include 'nav.html' %}

    <div class="profile container">
        <div class="profile_grid">

            <div>
                <div class="flex">
                    <div>
                        {% if user.user_avatar %}
                            <div class="avatar" style="background-image: url('../../{{ user.user_avatar[0].path }}')" onclick="open_uploader()"></div>
                        {% else %}
                            <div class="avatar" onclick="open_uploader()"></div>
                        {% endif %}
                    </div>
                    <div class="user__info">
                        <h2>{{ user.username }}</h2>
                        <p>Member Since: <br> {{ user.date_of_reg.strftime('%d.%m.%Y') }}</p>
                    </div>
                </div>
                
                <br>
                <h5>Reputation: {{ reputation }}</h5>
                <h5>Followers: {{ followers_count }}</h5>
                <br> 

                {% if id != session["id"] %}
                    {% if not follow %}
                        <a class="glow-on-hover" href="/profile/{{ id }}/follow" type="button">Follow</a>
                    {% else %}
                        <a class="glow-on-hover" href="/profile/{{ id }}/follow" type="button">Followed</a>
                    {% endif %}
                {% endif %}

                <br><br>

                <div>
                    <h4>Following</h4>
                    {% for f in following %}
                        <div class="card bg-light mb-3" style="max-width: 18rem;">
                            <a href="/profile/{{ f.id }}" class="text-decoration-none text-dark">
                                <div class="card-body">
                                    <div class="flex">
                                        {% if f.user_avatar %}
                                            <div>
                                                <div class="avatar_little" style="background-image: url('../../{{ f.user_avatar[0].path }}')"></div>
                                            </div>
                                        {% else %}
                                            <div>
                                                <div class="avatar_little"></div>
                                            </div>
                                        {% endif %}
                                        <h5 class="card-title">&nbsp;&nbsp;{{ f.username }}</h5>
                                    </div>
                                </div>
                            </a>
                        </div>
                    {% endfor %}

                    {% if following|count == 7 %}
                        <p><a href="/following/{{ id }}" class="text-decoration-none">Full list of following</a></p>
                    {% endif %}
                </div>


            </div>

            <div>
                <h3>The last questions</h3>

                {% if questions %}
                    {% for question in questions %}
                        <div class="card main_content__question">
                            <div class="card-body">
                                <h5 class="card-title"><a href="/question/{{ question.id }}" class="main_content__link">{{ question.title }}</a></h5>
                                <p class="card-text">{{ question.author.username }} | {{ question.date.strftime('%d.%m.%Y') }}</p>
                                <p class="card-text">
                                    {% for qt in question.question_obj %}
                                        <a href="/tag/{{ qt.tag.id }}" class="btn btn-secondary btn-sm">{{ qt.tag.tag }}</a>
                                    {% endfor %}
                                </p>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <pre>No questions yet</pre>
                {% endif %}
                <div>

                </div>
            </div>

        </div>
    </div>

    <div class="avatar_uploader">
        <div>
            <p class="close_uploader" onclick="close_uploader()">x</p>

            <script class="jsbin" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
            <div class="file-upload">
            
                <form action = "/profile/avatar" method="POST" enctype = "multipart/form-data">
                    <div class="image-upload-wrap">
                        <input class="file-upload-input" type='file' name="file" onchange="readURL(this);" accept="image/*" required />
                        <div class="drag-text">
                        <h3>Drag and drop a file or select add Image</h3>
                        </div>
                    </div>

                    <div class="file-upload-content">
                        <img class="file-upload-image" src="#" alt="your image" />
                        <div class="image-title-wrap">
                        <p><span class="image-title">Uploaded Image</span></p>
                        <button type="submit" class="upload-image-btn">Upload</button>
                        <button type="button" onclick="removeUpload()" class="remove-image">Remove</button>
                    </div>

                    <!-- <div class="file-upload-content">
                        <img class="file-upload-image" src="#" alt="your image" />
                        <div class="image-title-wrap">
                        <button type="submit" class="upload-image-btn">Remove <span class="image-title">Uploaded Image</span></button>
                    </div> -->
                </form>  

            </div>
            </div>
        </div>
    </div>

    <script src="../static/js/avatar_pop_up.js"></script>

    {% include 'footer.html' %}

{% endblock %}